"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var i=n(e),r=function(e){var n=e.page,r=e.pageHeight,a=e.pageWidth,u=e.rotation,c=e.thumbnailHeight,o=e.thumbnailWidth,l=i.useRef(),s=i.useState(""),g=s[0],h=s[1];return i.useEffect((function(){var e=l.current;e&&e.cancel();var t=document.createElement("canvas"),i=t.getContext("2d",{alpha:!1}),c=o,s=c/(a/r),g=c/a;t.height=s,t.width=c,t.style.height=s+"px",t.style.width=c+"px";var p=n.getViewport({rotation:u,scale:g});l.current=n.render({canvasContext:i,viewport:p}),l.current.promise.then((function(){return h(t.toDataURL())}),(function(){}))}),[u]),g?i.createElement("img",{src:g,height:c+"px",width:o+"px"}):i.createElement(t.Spinner,null)},a=function(e){var n=e.doc,a=e.isActive,u=e.pageHeight,c=e.pageIndex,o=e.pageWidth,l=e.rotation,s=e.onActive,g=i.useState({height:u,isCalculated:!1,page:null,viewportRotation:0,width:o}),h=g[0],p=g[1],d=i.useRef({isVisible:!1,ratio:0}),f=h.isCalculated,b=h.page,m=h.height,v=h.width,E=v/m,w=Math.abs(l)%180==0,P=w?100:100/E,H=w?100/E:100;i.useLayoutEffect((function(){if(a){var e=x.current,t=d.current;(!t.isVisible||t.ratio<1)&&s(e)}}),[a]);var _=(l+h.viewportRotation)%360,x=t.useIntersectionObserver({onVisibilityChanged:function(e){d.current=e,e.isVisible&&!f&&n.getPage(c+1).then((function(e){var t=e.getViewport({scale:1});p({height:t.height,isCalculated:!0,page:e,viewportRotation:t.rotation,width:t.width})}))}});return i.createElement("div",{className:"rpv-thumbnail__container",ref:x,style:{height:H+"px",width:P+"px"}},b?i.createElement(r,{page:b,pageHeight:w?m:v,pageWidth:w?v:m,rotation:_,thumbnailHeight:H,thumbnailWidth:P}):i.createElement(t.Spinner,null))},u=function(e){var t=e.currentPage,n=e.doc,r=e.pageHeight,u=e.pageWidth,c=e.rotation,o=e.onJumpToPage,l=n.numPages,s=i.useRef(null),g=function(e){var t=s.current;t&&function(e,t){var n=e.getBoundingClientRect().top-t.getBoundingClientRect().top,i=e.clientHeight,r=t.clientHeight;n<0?t.scrollTop+=n:n+i<=r||(t.scrollTop+=n+i-r)}(e.parentElement,t)};return i.createElement("div",{ref:s,className:"rpv-thumbnail__list"},Array(l).fill(0).map((function(e,l){return i.createElement("div",{className:(s={"rpv-thumbnail__item":!0,"rpv-thumbnail__item--selected":t===l},h=[],Object.keys(s).forEach((function(e){e&&s[e]&&h.push(e)})),h.join(" ")),key:"thumbnail-"+l,onClick:function(){return o(l)}},i.createElement(a,{doc:n,isActive:t===l,pageHeight:r,pageIndex:l,pageWidth:u,rotation:c,onActive:g}));var s,h})))},c=function(e){var n=e.store,r=e.onThumbnailClick,a=i.useState(n.get("doc")),c=a[0],o=a[1],l=i.useState(n.get("currentPage")||0),s=l[0],g=l[1],h=i.useState(n.get("pageHeight")||0),p=h[0],d=h[1],f=i.useState(n.get("pageWidth")||0),b=f[0],m=f[1],v=i.useState(n.get("rotation")||0),E=v[0],w=v[1],P=function(e){g(e)},H=function(e){o(e)},_=function(e){d(e)},x=function(e){m(e)},y=function(e){w(e)};return i.useEffect((function(){return n.subscribe("doc",H),n.subscribe("pageHeight",_),n.subscribe("pageWidth",x),n.subscribe("rotation",y),function(){n.unsubscribe("doc",H),n.unsubscribe("pageHeight",_),n.unsubscribe("pageWidth",x),n.unsubscribe("rotation",y)}}),[]),t.useIsomorphicLayoutEffect((function(){return n.subscribe("currentPage",P),function(){n.unsubscribe("currentPage",P)}}),[]),c?i.createElement(u,{currentPage:s,doc:c,pageHeight:p,pageWidth:b,rotation:E,onJumpToPage:function(e){var t=n.get("jumpToPage");t&&t(e),r&&r(e)}}):i.createElement("div",{className:"rpv-thumbnail__loader"},i.createElement(t.Spinner,null))};exports.thumbnailPlugin=function(){var e=i.useMemo((function(){return t.createStore({})}),[]);return{install:function(t){e.update("jumpToPage",t.jumpToPage)},onDocumentLoad:function(t){e.update("doc",t.doc)},onViewerStateChange:function(t){return e.update("currentPage",t.pageIndex),e.update("pageHeight",t.pageHeight),e.update("pageWidth",t.pageWidth),t},Thumbnails:function(t){return i.createElement(c,{store:e,onThumbnailClick:t.onThumbnailClick})}}};
